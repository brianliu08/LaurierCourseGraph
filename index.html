<!DOCTYPE html>
<html>
  <head>
	<title>Course Graph</title>
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-capable" content="yes">
	
	<script src="bower_components/platform/platform.js"></script>
	
	<link rel="import"
		  href="bower_components/core-scaffold/core-scaffold.html">
	<link rel="import"
		  href="bower_components/core-header-panel/core-header-panel.html">
	<link rel="import"
		  href="bower_components/core-menu/core-menu.html">
	<link rel="import"
		  href="bower_components/core-menu/core-submenu.html">
	<link rel="import"
		  href="bower_components/core-item/core-item.html">
	<link rel="import"
		  href="bower_components/core-ajax/core-ajax.html">
	<link rel="import"
		  href="tag-list.html">
	<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
	<script type="text/javascript" language="javascript" src="dep.json"></script> 
	<script src="bower_components/Processing.js/processing.js"></script>
    <script src="depGraph.js"></script>
	<script type="text/javascript" language="javascrip">
	 
	 var w = $(window).innerWidth()
	 var h = $(window).innerHeight()
	 function doResize()
	 {
	   w = $(window).innerWidth()
	   h = $(window).innerHeight()
	 }
	 
	 $(window).resize(doResize);
	</script>

	<script>
	 var courses = {};
	 var refresh = true;
	 window.addEventListener('polymer-ready',
							 function(e) {
	   
	   var facultyTag = document.querySelector('#faculty');
	   var departmentTag = document.querySelector('#department');
	   console.log(facultyTag)
	   console.log('before fac tags', facultyTag.tags)
	   facultyTag.tags = Object.keys(dep);
	   console.log('fac tags', facultyTag.tags)

	   function updateCourses() {
		 departmentActiveList = departmentTag.active['Department'];
         if (departmentActiveList == undefined) {
           return;
         }
		 facultyActiveList = facultyTag.active['Faculty'];
		 courses = {};
		 for (var i = 0; i < departmentActiveList.length; i++) {
		   var department = departmentActiveList[i];
		   for (var j = 0; j < facultyActiveList.length; j++) {
			 faculty = facultyActiveList[j];
			 if (dep[faculty][department] != undefined) {
			   classKeys = Object.keys(dep[faculty][department])
			   for (var k = 0; k < classKeys.length; k++) {
				 key = classKeys[k]
				 courses[key] = dep[faculty][department][key];
			   }
			 }
		   }
		 }
		 refresh = true;
	   }
	   window.addEventListener('Faculty-updated', function(e) {
		 var departments = [];
		 facultyActiveList = facultyTag.active['Faculty'];
		 for (var i = 0; i < facultyActiveList.length; i++) {
		   var faculty = facultyActiveList[i]

		   departments = departments.concat(Object.keys(dep[faculty]));
		 }
		 departmentTag.tags = departments;
		 updateCourses();
	   });
	   
	   window.addEventListener('Department-updated', function(e) {
		 updateCourses();
	   });
	 });
	</script>	


	<style>
     html, body {
       height: 100%;
       margin: 0;
     }
	 
     body {
       font-family: sans-serif;
     }
     
     core-header-panel {
       position: absolute;
       top: 0;
       bottom: 0;
       left: 0;
	   width:200px;
	   background-color:#fff;
	   display: inline;
     }

	 core-toolbar {
	   background-color: #526E9C;
	   color: #fff;
	 }
     
	</style>
	
  </head>
  
  <body unresolved>
	<canvas id="mycanvas" width=100% height=100%></canvas>
    <core-header-panel navigation flex mode="seamed">
	  <core-toolbar >Course Graph</core-toolbar>
	  <tag-list id="faculty" title="Faculty"></tag-list>
	  <tag-list id="department" title="Department"></tag-list>
    </core-header-panel>

    <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                              })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
     
     ga('create', 'UA-52076277-1', 'auto');
     ga('send', 'pageview');
     
    </script>
  </body>
</html>
